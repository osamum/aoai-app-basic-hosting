# 演習 2-4 : アプリケーションを利用するユーザーを制限する

Web サイトのコンテンツやアプリケーションについて、利用を管理しているユーザーに限定したい場合があります。

こうしたニーズを満たすために、かつてはほとんどの Web サーバーでサポートされ、設定も簡単に行える基本認証がよく使用されていましたが、現在ではセキュリティの強化やデータ保護の観点から基本認証は推奨されていません。

Azure App Service では、基本認証の代わりに、Azure Active Directory (Azure AD) や他の ID プロバイダーを使用した認証を行うことができます。

とくに App Service の提供する自動認証 (Easy Auth) を使用すると、コードの記述を行うことなく、OAuth を使用した認証を静的 Web ページのみの Web サイトにも導入することができます。

また、プログラム コードを使用し、認証で得られたトークンをアプリケーション側で取得して使用することもできます。

この手順については、マイクロソフトの公式のクイック スタートで詳しい手順が説明されているので、以下のクイック スタートのドキュメントを参考に演習用アプリケーションに認証を導入してください。(※なお、同ドキュメントに記述されているクリーンアップの手順は、このハンズオン中は実施しないでください。アプリケーションが削除されるとこの後の演習が続行できません)

\[**手順**▶️\]

* [**チュートリアル: Azure App Service で実行されている Web アプリにアプリの認証を追加する**](https://learn.microsoft.com/ja-jp/azure/app-service/scenario-secure-app-authentication-app-service)


正しく認証が設定されると、演習用アプリケーションへのアクセス時にログイン画面が表示されるようになります。

<img src="images/AppService_Auto_Outh.png" width="300px">

なお、この設定は同じアプリケーションで SPA が利用している API にも適用されるため、API へのアクセスも認証が必要になります。ただし、同一アプリケーション内であれば認証情報は共有されるので個別に認証する必要はありません。たとえば、この演習で使用しているアプリケーションは SPA であり、UI のページから以下のエンドポイントのpostMessage メソッドを呼び出していますが、UI ページにログインしていれば API の呼び出しも成功します。

```
https://botapp-<UniqueID>.azurewebsites.net/postMessage
```

今回は App Service の機能の説明であるためプログラミングについての説明は割愛しますが、自動認証によって得られたトークンの取得方法、認証トークンの更新方法については以下のドキュメントを参照してください。

* [**Azure App Service 認証で OAuth トークンを操作する**](https://learn.microsoft.com/ja-jp/azure/app-service/configure-authentication-oauth-tokens#retrieve-tokens-in-app-code)

<br>

## 次へ

👉　[**# 演習 3 : Advanced な可用性と監視の設定**](Ex03.md)

---

👈　[演習 2-3-3 : Azure AI Search 関連のバックアップ](Ex02-3-3.md)

🏚️　[README に戻る](README.md)